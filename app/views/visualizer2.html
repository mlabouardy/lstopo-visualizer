<h2>lstopo</h2>
<div>
    <div ng-repeat="entity in entities">
        <div ng-if="isNode(entity)">
            
            <div class="node">
                <div class="numanode">
                    <p>{{entity.numanode.type}} P#{{entity.numanode.os_index}} ({{convertMemory(entity.numanode.local_memory, "gb")}}GB)</p>
                </div>

                <div>
                    <div class="insidePackage">
                        <p>{{entity.packageOfCacheAndCores.type}} P#{{entity.packageOfCacheAndCores.os_index}}</p>

                        <div class="caches">
                            <span ng-repeat="cache3 in entity.packageOfCacheAndCores.caches | filter:{ type: 'L3Cache' }" ng-style="{'width': sizeCache(entity.packageOfCacheAndCores.caches, 'L3Cache')}">
                                <p>L{{cache3.depth}} ({{convertMemory(cache3.cache_size, "mb")}}MB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache2 in entity.packageOfCacheAndCores.caches | filter:{ type: 'L2Cache' }" ng-style="{'width': sizeCache(entity.packageOfCacheAndCores.caches, 'L2Cache')}">
                                <p>L{{cache2.depth}} ({{convertMemory(cache2.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1 in entity.packageOfCacheAndCores.caches | filter:{ type: 'L1Cache' }" ng-style="{'width': sizeCache(entity.packageOfCacheAndCores.caches, 'L1Cache')}">
                                <p>L{{cache1.depth}} ({{convertMemory(cache1.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1bis in entity.packageOfCacheAndCores.caches | filter:{ type: 'L1iCache' }" ng-style="{'width': sizeCache(entity.packageOfCacheAndCores.caches, 'L1iCache')}">
                                <p>L{{cache1bis.depth}}i ({{convertMemory(cache1bis.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="cores">
                            <span ng-repeat="core in entity.packageOfCacheAndCores.cores" ng-style="{'width': sizeCache(entity.packageOfCacheAndCores.cores, 'Core')}">
                                <p>{{core.type}} P#{{core.os_index}}</p>

                                <div class="pus">
                                    <div class="pu" ng-repeat="pu in core.pus">
                                        <p>{{pu.type}} P#{{pu.os_index}}</p>
                                    </div>
                                </div>

                            </span>
                        </div>

                    </div>

                    <div class="pcis">
                        <div id="div{{$index}}" ng-controller="TestCtrl" ng-init="begin(entity.entitiesBridge, $index, $event)" >

                            
                        </div>
                        <!--<ul>
                            <li ng-repeat="bridge in entity.entitiesBridge">
                                <p>{{bridge.type}} {{bridge.depth}}</p>

                                <ul>
                                    <li ng-repeat="bridge in bridge.entitiesBridge" ng-include="'bridgeTree'">
                                    
                                    </li>
                                </ul> 
                            
                            </li>
                        </ul> -->
                        <script src="scripts/graph_PCI/libs/jquery.min.js"></script>
                        <script src="scripts/graph_PCI/libs/lodash.min.js"></script>
                        <script src="scripts/graph_PCI/libs/backbone-min.js"></script>
                        <script src="scripts/graph_PCI/libs/joint.js"></script>
                        <script src="scripts/graph_PCI/graph_PCI.js"></script>
                    </div>

                </div>

            </div>

        </div>

        <div ng-if="isPackage(entity)">

            <div class="package">
                {{entity.type}} P#{{entity.depth}}

                <div ng-repeat="node in entity.entities" class="node">
                    <div class="numanode">
                        <p>{{node.numanode.type}} P#{{node.numanode.os_index}} ({{convertMemory(node.numanode.local_memory, "gb")}}GB)</p>
                    </div>

                    <div class="insideNode">
                        <div class="caches">
                            <span ng-repeat="cache3 in node.caches | filter:{ type: 'L3Cache' }" ng-style="{'width': sizeCache(node.caches, 'L3Cache')}">
                                <p>L{{cache3.depth}} ({{convertMemory(cache3.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache2 in node.caches | filter:{ type: 'L2Cache' }" ng-style="{'width': sizeCache(node.caches, 'L2Cache')}">
                                <p>L{{cache2.depth}} ({{convertMemory(cache2.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1 in node.caches | filter:{ type: 'L1Cache' }" ng-style="{'width': sizeCache(node.caches, 'L1Cache')}">
                                <p>L{{cache1.depth}} ({{convertMemory(cache1.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1bis in node.caches | filter:{ type: 'L1iCache' }" ng-style="{'width': sizeCache(node.caches, 'L1iCache')}">
                                <p>L{{cache1bis.depth}} ({{convertMemory(cache1bis.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="coresInNode">
                            <span ng-repeat="core in node.cores" ng-style="{'width': sizeCache(node.cores, 'Core')}">
                                <p>{{core.type}} P#{{core.os_index}}</p>

                                <div class="pus">
                                    <div class="pu" ng-repeat="pu in core.pus">
                                        <p>{{pu.type}} P#{{pu.os_index}}</p>
                                    </div>
                                </div>

                            </span>
                        </div>
                    </div>

                </div>
            </div>

        </div>


         <div ng-if="isGroup(entity)">

            <div class="package">
                {{entity.type}} P#{{entity.depth}}

                <div ng-repeat="node in entity.entities" class="node">
                    <div class="numanode">
                        <p>
                            {{node.numanode.type}} P#{{node.numanode.os_index}} ({{convertMemory(node.numanode.local_memory, "gb")}}GB)</p>
                    </div>

                    <div class="insideNode">
                        <div class="caches">
                            <span ng-repeat="cache3 in node.packageOfCacheAndCores.caches | filter:{ type: 'L3Cache' }" ng-style="{'width': sizeCache(node.caches, 'L3Cache')}">

                                <p>
                                    L{{cache3.depth}} ({{convertMemory(cache3.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache2 in node.packageOfCacheAndCores.caches | filter:{ type: 'L2Cache' }" ng-style="{'width': sizeCache(node.caches, 'L2Cache')}">
                                <p>L{{cache2.depth}} ({{convertMemory(cache2.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1 in node.packageOfCacheAndCores.caches | filter:{ type: 'L1Cache' }" ng-style="{'width': sizeCache(node.caches, 'L1Cache')}">
                                <p>L{{cache1.depth}} ({{convertMemory(cache1.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="caches">
                            <span ng-repeat="cache1bis in node.packageOfCacheAndCores.caches | filter:{ type: 'L1iCache' }" ng-style="{'width': sizeCache(node.caches, 'L1iCache')}">
                                <p>L{{cache1bis.depth}} ({{convertMemory(cache1bis.cache_size, "kb")}}KB)</p>
                            </span>
                        </div>

                        <div class="coresInNode">
                            <span ng-repeat="core in node.packageOfCacheAndCores.cores" ng-style="{'width': sizeCache(node.cores, 'Core')}">
                                <p>{{core.type}} P#{{core.os_index}}</p>

                                <div class="pus">
                                    <div class="pu" ng-repeat="pu in core.pus">
                                        <p>{{pu.type}} P#{{pu.os_index}}</p>
                                    </div>
                                </div>

                            </span>
                        </div>
                    </div>

                </div>
            </div>

        </div>

        <div ng-if="isSocket(entity)">

            <div class="socket">
                {{entity.type}} P#{{entity.os_index}}

                <div class="caches">
                    <span ng-repeat="cache3 in entity.caches | filter:{ depth: '3', cache_type: '0'}" ng-style="{'width': sizeCacheWithDepthAndType(entity.caches, '3', '0')}">
                        <p>L{{cache3.depth}} ({{convertMemory(cache3.cache_size, "kb")}}KB)</p>
                    </span>
                </div>

                <div class="caches">
                    <span ng-repeat="cache2 in entity.caches | filter:{ depth: '2', cache_type: '0' }" ng-style="{'width': sizeCacheWithDepthAndType(entity.caches, '2', '0')}">
                        <p>L{{cache2.depth}} ({{convertMemory(cache2.cache_size, "kb")}}KB)</p>
                    </span>
                </div>

                <div class="caches">
                    <span ng-repeat="cache1 in entity.caches | filter:{ depth: '1', cache_type: '1'}" ng-style="{'width': sizeCacheWithDepthAndType(entity.caches, '1', '1')}">
                        <p>L{{cache1.depth}}d ({{convertMemory(cache1.cache_size, "kb")}}KB)</p>
                    </span>
                </div>

                <div class="caches">
                    <span ng-repeat="cache1bis in entity.caches | filter:{ depth: '1', cache_type: '2'}" ng-style="{'width': sizeCacheWithDepthAndType(entity.caches, '1', '2')}">
                        <p>L{{cache1bis.depth}}i ({{convertMemory(cache1bis.cache_size, "kb")}}KB)</p>
                    </span>
                </div>

                <div class="cores">
                    <span ng-repeat="core in entity.cores" ng-style="{'width': sizeCache(entity.cores, 'Core')}">
                        <p>{{core.type}} P#{{core.os_index}}</p>

                        <div class="pus">
                            <div class="pu" ng-repeat="pu in core.pus">
                                <p>{{pu.type}} P#{{pu.os_index}}</p>
                            </div>
                        </div>

                    </span>
                </div>

            </div>

        </div>


    </div>
</div>

<!-- template récursif pour l'affichage des bridges -->
<script type="text/ng-template" id="bridgeTree">
    <p>{{bridge.type}} {{bridge.depth}}</p>
    <div class="pci" ng-repeat="pci in bridge.entitiesPciDev">
        <p>{{pci.type}}<p>
    </div>
    <ul ng-if="bridge.entitiesBridge">
        <li ng-repeat="bridge in bridge.entitiesBridge" ng-include="'bridgeTree'">
        </li>
    </ul>
</script>